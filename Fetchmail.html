<h1 id="Fetchmail">Fetchmail</h1>
<p>Fetchmail is standalone MRA (Mail Retrieval Agent) aka &quot;IMAP/POP3 client&quot;. Its sole purpose is to fetch your messages and store it locally or feed to local MTA (Message Transfer Agent). It cannot &quot;read&quot; messages â€” for that use MUA like Thunderbird or <a href="/wiki/wiki/Mutt">Mutt</a>.</p>
<h2 id="Installation">Installation</h2>
<p><code>yum install fetchmail</code></p>
<h2 id="Configuration">Configuration</h2>
<p>Assuming you have more than one account (safe assumption these days), you need to spawn multiple fetchmail instances, one for each IMAP/POP3 server (though one instance can watch over several accounts on one server). The easiest way is to create template systemd unit and start it several times. Fedora does not supply any, so we have to write one anyway.</p>
<p><strong>NOTE:</strong> this assumes you use <a href="/wiki/wiki/Postfix">Postfix</a> as your local MTA.</p>
<p>In TemplateVM create <code>/etc/systemd/system/fetchmail@.service</code>:</p>
<pre class="wiki"><code>[Unit]
Description=Mail Retrieval Agent
After=network.target
Requires=postfix.service

[Service]
User=user
ExecStart=/bin/fetchmail -f /usr/local/etc/fetchmail/%I.rc -d 60 -i /usr/local/etc/fetchmail/.%I.fetchids --pidfile /usr/local/etc/fetchmail/.%I.pid
RestartSec=1</code></pre>
<p>Then shutdown TemplateVM, start AppVM and create directory <code>/usr/local/etc/fetchmail</code>. In it, create one <code>.rc</code> file for each instance of fetchmail, ie. <code>personal1.rc</code> and <code>personal2.rc</code>. Sample configuration file:</p>
<pre class="wiki"><code>set syslog
set no bouncemail
#set daemon 600

poll mailserver1.com proto imap
    no dns
    uidl
    tracepolls
user woju pass supersecret
    ssl
    sslproto &quot;TLS1&quot;
    sslcertfile &quot;/etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt&quot;
    sslcertck
    mda &quot;/usr/sbin/sendmail -i -f %F -- user&quot;
    fetchall
    idle

# vim: ft=fetchmail</code></pre>
<p>Then <code>chown -R user:user /usr/local/etc/fetchmail</code> and <code>chmod 600 /usr/local/etc/fetchmail/*.rc</code>. <strong>This is important</strong>, fetchmail will refuse to run with wrong permissions on its rc-file.</p>
<p>Next, add this to <code>/rw/config/rc.local</code>:</p>
<pre class="wiki"><code>#!/bin/sh

for rc in /usr/local/etc/fetchmail/*.rc; do
        instance=${rc%.*}
        instance=${instance##*/}
        echo systemctl --no-block start fetchmail@${instance}
done</code></pre>
<p>Now reboot your AppVM and you are done.</p>
