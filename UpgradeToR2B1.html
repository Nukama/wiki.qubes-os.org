<h1 id="UpgradingQubesR1toR2beta">Upgrading Qubes R1 to R2 (beta)</h1>
<p><strong>Note: Qubes R2 Beta has not been release yet, DO NOT follow those instructions before R2 Beta is released</strong></p>
<p>Existing users of Qubes R1 (but not R1 betas!) can upgrade their systems to the latest R2 beta release by following the procedure below. As usual, it is advisable to backup the system before proceeding with the upgrade</p>
<h2 id="UpgradeallTemplateandStandaloneVMs">Upgrade all Template and Standalone VM(s)</h2>
<p>By default, in Qubes R1, there is only one Template VM, however users are free to create more Template VMs for special purposes, as well as Standalone VMs. More information on using multiple Template VMs, as well as Standalone VMs, can be found [SoftwareUpdateVM here]. The steps described in this section should be repeated in <em>all</em> user's Template and Standalone VMs.</p>
<ol>
<li>Open terminal in the template VM (or standalone VM). E.g. use the Qubes Manager's right-click menu and choose Run Command in VM and type <code>gnome-terminal</code> there.</li>
<li><p>Install <code>qubes-upgrade-vm</code> package (this package brings in R2 repo definitions and R2 keys)</p>
<pre class="wiki"><code>sudo yum install qubes-upgrade-vm</code></pre></li>
<li><p>Proceed with normal update in the template (this should bring in also the R2 packages for the VMs):</p>
<pre class="wiki"><code>sudo yum update</code></pre>
<p>The installer (yum) will prompt to accept the new Qubes R2 signing key:</p>
<pre class="wiki"><code>Importing GPG key 0x0A40E458:
 Userid     : &quot;Qubes OS Release 2 Signing Key&quot;
 Fingerprint: 3f01 def4 9719 158e f862 66f8 0c73 b9d4 0a40 e458
 Package    : qubes-upgrade-vm-1.0-1.fc17.x86_64 (@qubes-vm-current)
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-upgrade-qubes-2-primary
Is this ok [y/N]:</code></pre>
<p>If you see (as is the case on the &quot;screenshot&quot; above) that the new key was imported from a local filesystem (<code>/etc/pki/rpm-gpg/...</code>) you can safely accept the key, without checking its fingerprint. This is because there were only two ways for such a key to make it to your Template VM's filesystem:</p></li>
</ol>
<ul>
<li>via a legitimate RPM package previously installed (in our case it was the <code>qubes-upgrade-vm</code> RPM). Such an RPM must have been signed by one of the keys you decided to trust previously, by default this would be either via the Qubes R1 signing key, or Fedora 17 signing key.</li>
<li>via system compromise or via some illegal RPM package (e.g. Fedora released package pretending to bring new Firefox). In that case, however, your VM is already compromised, and it careful checking of the new R2 key would not change this situation to any better one. The game is lost for this VM anyway (and all VMs based on this template).</li>
</ul>
<ol start="4">
<li>Shut down the VM.</li>
</ol>
<h2 id="UpgradeDom0">Upgrade Dom0</h2>
<p>Be sure to do steps described in this section after <em>all</em> your template and standalone VMs got updated as described in the section above.</p>
<ol>
<li>Open terminal in Dom0. E.g. Start-&gt;System Settings-&gt;Konsole.</li>
<li><p>Upgrade the <code>qubes-release</code> package to the latest version which brings in new repo definitions and R2 signing keys:</p>
<pre class="wiki"><code>sudo qubes-dom0-update qubes-release</code></pre>
<p>This should install <code>qubes-release-1-6</code> in your Dom0.</p></li>
<li><p>Install R2 packages:</p>
<pre class="wiki"><code>sudo qubes-dom0-update --releasever=2</code></pre></li>
<li>Reboot your system. Please note that if you use Anti Evil Maid, then it won't be able to unseal the passphrase this time, because the Xen, kernel, and initramfs binaries have changed. Once the system boots up again, you could reseal your Anti Evil Maid's passphrase to the new configuration. Please consult Anti Evil Maid documentation for explanation on how to do that.</li>
</ol>
