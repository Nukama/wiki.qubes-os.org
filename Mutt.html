<h1 id="Mutt">Mutt</h1>
<p>Mutt is a fast, standards-compliant, efficient MUA (Mail User Agent). In some areas it works better than Thunderbird+Enigmail, and is certainly faster and more responsive.</p>
<p>Mutt lacks true MTA (Message Transfer Agent aka &quot;SMTP client&quot;) and MRA (Mail Retrieval Agent aka &quot;IMAP/POP3 client&quot;), thus there are some provisions built-in. In principle it is only mail reader and composer. You may install true MTA such as <a href="/wiki/wiki/Postfix">Postfix</a> or Exim and MRA such as <a href="/wiki/wiki/Fetchmail">Fetchmail</a>.</p>
<h2 id="Installation">Installation</h2>
<p><code>yum install mutt</code></p>
<h2 id="Configuration">Configuration</h2>
<p>Mutt generally works out of the box. This configuration guide discusses only Qubes-specific setup. In this example we will have one TemplateVM and several AppVMs. It also takes advantage of <a href="/wiki/wiki/SplitGPG">SplitGPG?</a>, which is assumed to be already working.</p>
<p><strong>NOTE:</strong> this requires <code>qubes-gpg-split &gt;= 2.0.9</code>. 2.0.8 and earlier contains bug which causes this setup to hang in specific situations and does not allow to list keys.</p>
<p>First, paste this to <code>/etc/Muttrc.local</code> in TemplateVM:</p>
<pre class="wiki"><code># specify your key or override in ~/.mutt/muttrc in AppVM
set pgp_sign_as=&quot;0xDEADBEEF&quot;

set pgp_use_gpg_agent = no

# this needs qubes-gpg-split &gt;= 2.0.8; 2.0.7 end earlier has had a deadlock on this
set pgp_decode_command=&quot;qubes-gpg-client-wrapper --status-fd=2 --batch %f&quot;
#set pgp_decode_command=&quot;gpg --status-fd=2 %?p?--passphrase-fd=0? --no-verbose --quiet --batch --output - %f&quot;

set pgp_decrypt_command=&quot;$pgp_decode_command&quot;

set pgp_verify_command=&quot;qubes-gpg-client-wrapper --status-fd=2 --no-verbose --quiet --batch --output - --verify %s %f&quot;

set pgp_sign_command=&quot;qubes-gpg-client-wrapper --batch --armor --detach-sign --textmode %?a?-u %a? %f&quot;
set pgp_clearsign_command=&quot;qubes-gpg-client-wrapper --batch --armor --textmode --clearsign %?a?-u %a? %f&quot;

# I found no option to add Charset armor header when it is UTF-8, since this is
# default (as specified in RFC4880). This is needed to workaround bug in
# Enigmail, which ignores RFC and without this header Thunderbird interprets
# plaintext as us-ascii. See http://sourceforge.net/p/enigmail/bugs/38/.
set pgp_encrypt_only_command=&quot;pgpewrap qubes-gpg-client-wrapper --batch --textmode --armor --always-trust %?a?--encrypt-to %a? --encrypt -- -r %r -- %f | sed -e &#39;2iCharset: UTF-8&#39;&quot;
set pgp_encrypt_sign_command=&quot;pgpewrap qubes-gpg-client-wrapper --batch --textmode --armor --always-trust %?a?--encrypt-to %a? --encrypt --sign %?a?-u %a? -- -r %r -- %f | sed -e &#39;2iCharset: UTF-8&#39;&quot;

# we need to import both into vault and locally wrt $pgp_verify_command
set pgp_import_command=&quot;qubes-gpg-import-key %f; gpg --no-verbose --import %f&quot;

# those are unsupported by split-gpg
set pgp_export_command=&quot;gpg --no-verbose --export --armor %r&quot;
set pgp_verify_key_command=&quot;gpg --no-verbose --batch --fingerprint --check-sigs %r&quot;

# read in the public key ring
set pgp_list_pubring_command=&quot;qubes-gpg-client-wrapper --no-verbose --batch --quiet --with-colons --list-keys %r&quot;

# read in the secret key ring
set pgp_list_secring_command=&quot;qubes-gpg-client-wrapper --no-verbose --batch --quiet --with-colons --list-secret-keys %r&quot;

# this set the number of seconds to keep in memory the passpharse used to encrypt/sign
# the more the less secure it will be
set pgp_timeout=600

# it&#39;s a regexp used against the GPG output: if it matches some line of the output
# then mutt considers the message a good signed one (ignoring the GPG exit code)
#set pgp_good_sign=&quot;^gpg: Good signature from&quot;
set pgp_good_sign=&quot;^\\[GNUPG:\\] GOODSIG&quot;

# mutt uses by default PGP/GPG to sign/encrypt messages
# if you want to use S-mime instead set the smime_is_default variable to yes

# automatically sign all outcoming messages
set crypt_autosign=yes
# sign only replies to signed messages
#set crypt_replysign

# automatically encrypt outcoming messages
#set crypt_autoencrypt=yes
# encrypt only replies to signed messages
set crypt_replyencrypt=yes
# encrypt and sign replies to encrypted messages
set crypt_replysignencrypted=yes

# automatically verify the sign of a message when opened
set crypt_verify_sig=yes

send-hook &quot;~A&quot; set pgp_autoinline=no crypt_autoencrypt=no
send-hook &quot;~t @invisiblethingslab\.com&quot; set crypt_autoencrypt=yes

# vim:ft=muttrc</code></pre>
<p>Then shutdown your TemplateVM. Next open your AppVM, create file <code>/home/user/.mutt/muttrc</code> and adjust for your needs:</p>
<pre class="wiki"><code>#
# accounts
#
set from = &quot;Wojciech Zygmunt Porczyk &lt;woju@invisiblethingslab.com&gt;&quot;
alternates &#39;^woju@invisiblethingslab\.com$&#39;
alternates &#39;^wojciech@porczyk\.eu$&#39;

#
# crypto
#
set pgp_sign_as = &quot;0xDEADBEEF&quot;
send-hook &quot;~t @my\.family\.com&quot; set crypt_autoencrypt=no

#
# lists
#

# google groups
lists .*@googlegroups\.com

subscribe (qubes-(users|devel)|othergroup)@googlegroups\.com
fcc-save-hook qubes-users@googlegroups\.com =list/qubes-users/
fcc-save-hook qubes-devel@googlegroups\.com =list/qubes-devel/
fcc-save-hook othergroup@googlegroups\.com =list/othergroup/
</code></pre>
<p>You may also create <code>/home/user/.signature</code>:</p>
<pre class="wiki"><code>regards,
Wojciech Porczyk</code></pre>
