<h1 id="Nvidiaproprietarydriverinstallation">Nvidia proprietary driver installation</h1>
<p>The NVIDIA proprietary driver works <strong>much</strong> more stable than nouveau, so it's good idea to install it. But this is somehow complicated: First - download it from nvidia.com site. Here &quot;NVIDIA-Linux-x86_64-260.19.44.run&quot; is used. Copy it to dom0. Every next step is done in dom0.</p>
<h2 id="Userspacecomponents">Userspace components</h2>
<p>Install libraries, Xorg driver, configuration utilities. This can by done by nvidia-installer:</p>
<pre class="wiki"><code>./NVIDIA-Linux-x86_64-260.19.44.run --ui=none --no-x-check --keep --no-nouveau-check</code></pre>
<h2 id="Kernelmodule">Kernel module</h2>
<p>You will need:</p>
<ul>
<li>nvidia kernel module sources (left from previous step)</li>
<li>kernel-devel package installed</li>
<li>gcc, make, etc</li>
</ul>
<p>This installation must be done manually, because nvidia-installer refused to install it on Xen kernel. Firstly ensure that kernel-devel package installed all needed files. This should consists of:</p>
<ul>
<li><em>/usr/src/kernels/2.6.34.1-12.xenlinux.qubes.x86_64</em></li>
<li><em>/lib/modules/2.6.34.1-12.xenlinux.qubes.x86_64/build</em> symlinked to the above directory</li>
<li><em>/usr/src/kernels/2.6.34.1-12.xenlinux.qubes.x86_64/arch/x64/include/mach-xen</em> should be present (if not - take it from kernel sources)</li>
</ul>
<p>If it is not true - correct it manually. To build kernel module, enter <em>NVIDIA-Linux-x86_64-260.19.44/kernel</em> directory and execute:</p>
<pre class="wiki"><code>IGNORE_XEN_PRESENCE=1 CC=&quot;gcc -DNV_VMAP_4_PRESENT -DNV_SIGNAL_STRUCT_RLIM&quot; make -f Makefile.kbuild
mv /lib/modules/2.6.34.1-12.xenlinux.qubes.x86_64/kernel/drivers/video/nvidia.ko /lib/modules/2.6.34.1-12.xenlinux.qubes.x86_64/extra/</code></pre>
<p>Ignore error while inserting nvidia.ko (at the end of make phase). Now you should disable nouveau:</p>
<pre class="wiki"><code>cat /etc/modprobe.d/nouveau-disable.conf
# blacklist isn&#39;t enough...
install nouveau /bin/true</code></pre>
<h2 id="ConfigureXorg">Configure Xorg</h2>
<p>After all, you should configure Xorg to use nvidia driver. You can use <em>nvidia-xconfig</em> or do it manually:</p>
<pre class="wiki"><code>X -configure
mv /root/xorg.conf.new /etc/X11/xorg.conf
# replace Driver in Device section by &quot;nvidia&quot;</code></pre>
