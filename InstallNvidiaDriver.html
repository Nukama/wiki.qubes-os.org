<h1 id="Nvidiaproprietarydriverinstallation">Nvidia proprietary driver installation</h1>
<p>The NVIDIA proprietary driver works <strong>much</strong> more stable than nouveau, so it's good idea to install it.</p>
<h1 id="RpmFusionpackages"><a href="/wiki/wiki/RpmFusion">RpmFusion?</a> packages</h1>
<p>There are rpm packages with all necessary software on rpmfusion. The only package you have to compile is kernel module (but there is ready src.rpm package).</p>
<h2 id="Downloadpacakages">Download pacakages</h2>
<p>You will need any Fedora 13 system to download and build packages. You can use Qubes Dom0 for it, but it isn't necessary. To download packages from rpmfusion - add this repository to your yum configuration (instructions are on their website). After then download packages using yumdownloader:</p>
<pre class="wiki"><code>yumdownloader --resolve xorg-x11-drv-nvidia livna-config-display
yumdownloader --source nvidia-kmod</code></pre>
<h2 id="Buildkernelpackage">Build kernel package</h2>
<p>You will need at least rpmbuild tool, and then you can use it to build package:</p>
<pre class="wiki"><code>yum install rpm-build
rpmbuild --rebuild nvidia-kmod-260.19.36-1.fc13.3.src.rpm</code></pre>
<p>Most likely it will complain about missing dependencies - install it and rerun rpmbuid. If everything went right, you have now complete packages with nvidia drivers for Qubes system. Transfer them to dom0 (eg using USB stick), install and reboot the system.</p>
<h1 id="Manualinstallation">Manual installation</h1>
<p>But this is somehow complicated: First - download it from nvidia.com site. Here &quot;NVIDIA-Linux-x86_64-260.19.44.run&quot; is used. Copy it to dom0. Every next step is done in dom0.</p>
<p>See <a href="/wiki/wiki/CopyToDomZero">this page</a> for instruction on how to transfer files to Dom0 (where there is normally no networking).</p>
<p><strong>WARNING</strong>: Nvidia doesn't sign their files. To make it worse, you are forced to download them over a plaintext connection. This means there are virtually dozens of possibilities for somebody to modify this file and provide you with a malicious/backdoored file. You should realize that installing untrusted files into your Dom0 is really a bad idea. Perhaps it might be a better idea to just get a new laptop with integrated Intel GPU? You have been warned, anyway.</p>
<h2 id="Userspacecomponents">Userspace components</h2>
<p>Install libraries, Xorg driver, configuration utilities. This can by done by nvidia-installer:</p>
<pre class="wiki"><code>./NVIDIA-Linux-x86_64-260.19.44.run --ui=none --no-x-check --keep --no-nouveau-check --no-kernel-module</code></pre>
<h2 id="Kernelmodule">Kernel module</h2>
<p>You will need:</p>
<ul>
<li>nvidia kernel module sources (left from previous step)</li>
<li>kernel-devel package installed</li>
<li>gcc, make, etc</li>
</ul>
<p>This installation must be done manually, because nvidia-installer refused to install it on Xen kernel. Firstly ensure that kernel-devel package installed all needed files. This should consists of:</p>
<ul>
<li><em>/usr/src/kernels/2.6.34.1-12.xenlinux.qubes.x86_64</em></li>
<li><em>/lib/modules/2.6.34.1-12.xenlinux.qubes.x86_64/build</em> symlinked to the above directory</li>
<li><em>/usr/src/kernels/2.6.34.1-12.xenlinux.qubes.x86_64/arch/x64/include/mach-xen</em> should be present (if not - take it from kernel sources)</li>
</ul>
<p>If it is not true - correct it manually. To build kernel module, enter <em>NVIDIA-Linux-x86_64-260.19.44/kernel</em> directory and execute:</p>
<pre class="wiki"><code>make
IGNORE_XEN_PRESENCE=1 CC=&quot;gcc -DNV_VMAP_4_PRESENT -DNV_SIGNAL_STRUCT_RLIM&quot; make -f Makefile.kbuild
mv /lib/modules/2.6.34.1-12.xenlinux.qubes.x86_64/kernel/drivers/video/nvidia.ko /lib/modules/2.6.34.1-12.xenlinux.qubes.x86_64/extra/</code></pre>
<p>Ignore error while inserting nvidia.ko (at the end of make phase). Now you should disable nouveau:</p>
<pre class="wiki"><code>cat /etc/modprobe.d/nouveau-disable.conf
# blacklist isn&#39;t enough...
install nouveau /bin/true</code></pre>
<p>Add <em>rdblacklist=nouveau</em> option to /boot/grub/menu.lst (at the end of line containing <em>vmlinuz</em>).</p>
<h2 id="ConfigureXorg">Configure Xorg</h2>
<p>After all, you should configure Xorg to use nvidia driver. You can use <em>nvidia-xconfig</em> or do it manually:</p>
<pre class="wiki"><code>X -configure
mv /root/xorg.conf.new /etc/X11/xorg.conf
# replace Driver in Device section by &quot;nvidia&quot;</code></pre>
<p>Now you should reboot the system.</p>
